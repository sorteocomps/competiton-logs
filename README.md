# Sorteo Competition Logs

This repository contains the verification data for Sorteo prize draws. It serves as a public, immutable, and timestamped record of all draw-related data used to ensure fairness and transparency.

## Repository Purpose

This repository is an integral part of Sorteo's verification system. It provides:

1. **Transparency**: All data needed to verify the fairness of prize draws is publicly available
2. **Immutability**: GitHub's commit history creates a tamper-proof record of when data was created
3. **Auditability**: Anyone can audit the draw process without requiring special access

## Repository Structure

Verification data is organized in a hierarchical structure by date:

```
draws/
  YYYY/           # Year
    MM/           # Month
      DD/         # Day
        [prize-draw-id]/
          commitment.json   # Initial commitment data
          ticket-list.csv   # Anonymized list of tickets
          reveal.json       # Reveal data with block hash
```

## Understanding the Verification Files

### 1. commitment.json

This file contains the initial commitment data created before the draw:

```json
{
  "prizeDrawId": "123e4567-e89b-12d3-a456-426614174000",
  "prizeDrawName": "Charity Fundraiser 2023",
  "commitmentHash": "a1b2c3d4e5f6...",
  "localSeed": "9876543210abcdef...",
  "blockNumber": 12345678,
  "ticketListHash": "f1e2d3c4b5a6...",
  "ticketCount": 100,
  "createdAt": "2023-06-15T14:30:00.000Z"
}
```

Key fields:
- `prizeDrawId`: Unique identifier for the prize draw
- `localSeed`: Random seed generated by the system
- `blockNumber`: Future Ethereum block number used for randomness
- `commitmentHash`: SHA-256 hash of localSeed + blockNumber
- `ticketListHash`: SHA-256 hash of the ticket list CSV (added when draw ends)
- `ticketCount`: Number of tickets in the draw (added when draw ends)

### 2. ticket-list.csv

This file contains an anonymized list of all valid tickets in the draw:

```
id,ticketNumber,firstInitial,lastInitial,purchaseDate
abc123,100001,J,D,2023-06-10
def456,100002,M,S,2023-06-11
...
```

Privacy protections:
- Only initials are included, not full names
- No email addresses or other PII
- Ticket IDs allow correlation with winning tickets

### 3. reveal.json

This file contains the reveal data created after the target Ethereum block is mined:

```json
{
  "prizeDrawId": "123e4567-e89b-12d3-a456-426614174000",
  "commitmentId": "abc123def456...",
  "localSeed": "9876543210abcdef...",
  "blockNumber": 12345678,
  "commitmentHash": "a1b2c3d4e5f6...",
  "blockHash": "f1e2d3c4b5a6...",
  "combinedSeed": "0123456789abcdef...",
  "revealedAt": "2023-06-15T15:00:00.000Z"
}
```

Key fields:
- `blockHash`: Hash of the target Ethereum block
- `combinedSeed`: SHA-256 hash of localSeed + blockHash
- `revealedAt`: Timestamp when the reveal was created

## Verification Process

The commit-reveal protocol used by Sorteo ensures randomness cannot be manipulated:

1. **Commitment Phase**: 
   - A random local seed is generated
   - It's combined with a future Ethereum block number
   - The commitment hash is created and stored in this repository
   - The timestamp of this commit proves the commitment was made before the block was mined

2. **Ticket Collection Phase**:
   - Tickets are collected while waiting for the target block
   - When the draw ends, ticket list data is added to this repository
   - The ticket list hash ensures the ticket list cannot be changed

3. **Reveal Phase**:
   - After the target block is mined, its hash is retrieved
   - The hash is combined with the local seed to create a combined seed
   - The reveal data is uploaded to this repository
   - The timestamp of this commit proves when the reveal occurred

4. **Winner Selection**:
   - The combined seed is used to deterministically select a winning ticket
   - Since the combined seed could not be predicted or manipulated, the selection is provably fair

## Verification Tools

To simplify verification, we provide JavaScript tools in this repository:

- `verify.js`: Verifies all aspects of a specific prize draw
- `verify-formats.js`: Shows the exact string formats used for hashing
- `verify-blockchain-draw.js`: Demonstrates the winner selection algorithm

### Using the Verification Tools

```bash
# Install dependencies
npm install

# Verify a specific draw
node verify.js <prize-draw-id>

# Test the verification formats
node verify-formats.js

# Verify the winner selection algorithm
node verify-blockchain-draw.js <prize-draw-id>
```

## Auditing Draws

We encourage third-party audits of our prize draws. To audit a draw:

1. Find the draw folder using the prize draw ID
2. Verify the GitHub commit timestamps match the expected timeline
3. Verify all cryptographic hashes using the provided tools
4. Verify the winner selection using the combined seed and ticket list

For detailed auditing instructions, see [our auditor's guide](https://sorteo.io/help/auditors/).

## Contact Information

For questions about the verification system:

- **Email**: verification@sorteo.io
- **GitHub Issues**: Open an issue in this repository

## License

All verification data in this repository is available under the MIT License. 
The code for verification tools is also available under the MIT License.

Copyright (c) 2023 Sorteo Inc.