# Sorteo Competition Logs

This repository contains the verification data for Sorteo prize draws. It serves as a public, immutable, and timestamped record of all draw-related data used to ensure fairness and transparency.

## Repository Purpose

This repository is an integral part of Sorteo's verification system. It provides:

1. **Transparency**: All data needed to verify the fairness of prize draws is publicly available
2. **Immutability**: GitHub's commit history creates a tamper-proof record of when data was created
3. **Auditability**: Anyone can audit the draw process without requiring special access

## Repository Structure

Verification data is organized in a hierarchical structure by date:

```
draws/
  YYYY/           # Year
    MM/           # Month
      DD/         # Day
        [prize-draw-id]/
          commitment_rank1.json   # Commitment data for prize rank 1
          commitment_rank2.json   # Commitment data for prize rank 2 (if multiple prizes)
          ticket-list.csv         # Anonymized list of tickets
          reveal_rank1.json       # Reveal data for prize rank 1
          reveal_rank2.json       # Reveal data for prize rank 2 (if multiple prizes)
```

For competitions with multiple prizes, each prize has its own commitment and reveal files, identified by the prize rank in the filename.

## Understanding the Verification Files

### 1. commitment_rank*.json

Each commitment file contains the initial commitment data created before the draw for a specific prize:

```json
{
  "prizeDrawId": "123e4567-e89b-12d3-a456-426614174000",
  "prizeDrawName": "Charity Fundraiser 2023",
  "prizeRank": 1,
  "commitmentHash": "a1b2c3d4e5f6...",
  "localSeed": "9876543210abcdef...",
  "blockNumber": 12345678,
  "ticketListHash": "f1e2d3c4b5a6...",
  "ticketCount": 100,
  "createdAt": "2023-06-15T14:30:00.000Z"
}
```

Key fields:
- `prizeDrawId`: Unique identifier for the prize draw
- `prizeRank`: The rank/number of the prize (1 for first prize, 2 for second prize, etc.)
- `localSeed`: Random seed generated by the system
- `blockNumber`: Future Ethereum block number used for randomness
- `commitmentHash`: SHA-256 hash of localSeed + blockNumber
- `ticketListHash`: SHA-256 hash of the ticket list CSV (added when draw ends)
- `ticketCount`: Number of tickets in the draw (added when draw ends)

### 2. ticket-list.csv

This file contains an anonymized list of all valid tickets in the draw:

```
id,ticketNumber,firstInitial,lastInitial,purchaseDate
abc123,100001,J,D,2023-06-10
def456,100002,M,S,2023-06-11
...
```

Privacy protections:
- Only initials are included, not full names
- No email addresses or other PII
- Ticket IDs allow correlation with winning tickets

### 3. reveal_rank*.json

Each reveal file contains the reveal data created after the target Ethereum block is mined for a specific prize:

```json
{
  "prizeDrawId": "123e4567-e89b-12d3-a456-426614174000",
  "commitmentId": "abc123def456...",
  "prizeRank": 1,
  "localSeed": "9876543210abcdef...",
  "blockNumber": 12345678,
  "commitmentHash": "a1b2c3d4e5f6...",
  "blockHash": "f1e2d3c4b5a6...",
  "combinedSeed": "0123456789abcdef...",
  "revealedAt": "2023-06-15T15:00:00.000Z"
}
```

Key fields:
- `prizeRank`: The rank/number of the prize (1 for first prize, 2 for second prize, etc.)
- `blockHash`: Hash of the target Ethereum block
- `combinedSeed`: SHA-256 hash of localSeed + blockHash
- `revealedAt`: Timestamp when the reveal was created

## Verification Process

The commit-reveal protocol used by Sorteo ensures randomness cannot be manipulated:

1. **Commitment Phase**: 
   - A random local seed is generated
   - It's combined with a future Ethereum block number
   - The commitment hash is created and stored in this repository
   - The timestamp of this commit proves the commitment was made before the block was mined

2. **Ticket Collection Phase**:
   - Tickets are collected while waiting for the target block
   - When the draw ends, ticket list data is added to this repository
   - The ticket list hash ensures the ticket list cannot be changed

3. **Reveal Phase**:
   - After the target block is mined, its hash is retrieved
   - The hash is combined with the local seed to create a combined seed
   - The reveal data is uploaded to this repository
   - The timestamp of this commit proves when the reveal occurred

4. **Winner Selection**:
   - For each prize, the combined seed from its reveal is used to deterministically select a winning ticket
   - Each prize has its own independent selection process based on its unique combined seed
   - Since the combined seeds could not be predicted or manipulated, the selection is provably fair for all prizes

## Auditing Draws

We encourage third-party audits of our prize draws. To audit a draw:

1. Find the draw folder using the prize draw ID
2. Verify the GitHub commit timestamps match the expected timeline for all prizes
3. For each prize, verify all cryptographic hashes using the provided tools
4. For each prize, verify the winner selection using that prize's combined seed and the ticket list
5. Confirm that each prize had its own independent verification process

For detailed auditing instructions, see [our auditor's guide](https://sorteo.co.uk/help/auditors/).

## License

Creative Commons Attribution 4.0 International (CC BY 4.0)

This repository is licensed under the Creative Commons Attribution 4.0 International License.

You are free to:

- Share — copy and redistribute the material in any medium or format
- Adapt — remix, transform, and build upon the material for any purpose, even commercially

Under the following terms:

- Attribution — You must give appropriate credit, provide a link to the license, and indicate if changes were made.

Full legal code: https://creativecommons.org/licenses/by/4.0/legalcode  
Plain English summary: https://creativecommons.org/licenses/by/4.0/