# Sorteo Competition Logs

This repository contains the verification data for Sorteo prize draws. It serves as a public, immutable, and timestamped record of all draw-related data used to ensure fairness and transparency.

## Repository Purpose

This repository is an integral part of Sorteo's verification system. It provides:

1. **Transparency**: All data needed to verify the fairness of prize draws is publicly available
2. **Immutability**: GitHub's commit history creates a tamper-proof record of when data was created
3. **Auditability**: Anyone can audit the draw process without requiring special access

## Repository Structure

Verification data is organized in a hierarchical structure by date:

```
draws/
  YYYY/           # Year
    MM/           # Month
      DD/         # Day
        [prize-draw-id]/
          commitments.json       # JSON file with array of all prize commitments
          ticket_list.csv        # Anonymized list of tickets (single prize)
          ticket_list_prize_1.csv # Ticket list for prize rank 1 (if multiple prizes)
          ticket_list_prize_2.csv # Ticket list for prize rank 2 (if multiple prizes)
          reveals.json           # JSON file with array of all prize reveals
```

For draws with multiple prizes, all commitments and reveals are stored in single JSON files with arrays of prize-specific data. Each prize has its own entries within these files, identified by the prizeRank field.

## Understanding the Verification Files

### 1. commitments.json

This file contains an array of all commitment data for a prize draw, with separate entries for each prize:

```json
{
  "prizeDrawId": "123e4567-e89b-12d3-a456-426614174000",
  "prizeDrawName": "Charity Fundraiser 2023",
  "prizeCommitments": [
    {
      "prizeDrawId": "123e4567-e89b-12d3-a456-426614174000",
      "prizeDrawName": "Charity Fundraiser 2023",
      "prizeRank": 1,
      "commitmentHash": "a1b2c3d4e5f6...",
      "localSeed": "9876543210abcdef...",
      "blockNumber": 12345678,
      "ticketListHash": "f1e2d3c4b5a6...",
      "ticketCount": 100,
      "createdAt": "2023-06-15T14:30:00.000Z"
    },
    {
      "prizeDrawId": "123e4567-e89b-12d3-a456-426614174000",
      "prizeDrawName": "Charity Fundraiser 2023",
      "prizeRank": 2,
      "commitmentHash": "b2c3d4e5f6a7...",
      "localSeed": "3210abcdef9876...",
      "blockNumber": 12345678,
      "ticketListHash": "e2d3c4b5a6f1...",
      "ticketCount": 100,
      "createdAt": "2023-06-15T14:30:00.000Z"
    }
  ],
  "updatedAt": "2023-06-15T16:00:00.000Z"
}
```

Key fields for each commitment:
- `prizeDrawId`: Unique identifier for the prize draw
- `prizeRank`: The rank/number of the prize (1 for first prize, 2 for second prize, etc.)
- `localSeed`: Random seed generated by the system
- `blockNumber`: Future Ethereum block number used for randomness
- `commitmentHash`: SHA-256 hash of localSeed + blockNumber
- `ticketListHash`: SHA-256 hash of the ticket list CSV (added when draw ends)
- `ticketCount`: Number of tickets in the draw (added when draw ends)

### 2. ticket_list.csv

This file contains an anonymized list of all valid tickets in the draw:

```
id,ticketNumber,firstInitial,lastInitial,purchaseDate
abc123,100001,J,D,2023-06-10
def456,100002,M,S,2023-06-11
...
```

Privacy protections:
- Only initials are included, not full names
- No email addresses or other PII
- Ticket IDs allow correlation with winning tickets

Note: A single ticket list is used for all prizes in multi-prize draws. Each prize uses a different blockchain commitment and random seed to select winners from this same ticket list.

### 3. reveals.json

This file contains an array of all reveal data for a prize draw, with separate entries for each prize:

```json
{
  "prizeDrawId": "123e4567-e89b-12d3-a456-426614174000",
  "prizeDrawName": "Charity Fundraiser 2023",
  "prizeReveals": [
    {
      "prizeDrawId": "123e4567-e89b-12d3-a456-426614174000",
      "prizeRank": 1,
      "localSeed": "9876543210abcdef...",
      "blockNumber": 12345678,
      "commitmentHash": "a1b2c3d4e5f6...",
      "blockHash": "f1e2d3c4b5a6...",
      "combinedSeed": "0123456789abcdef...",
      "ticketListHash": "f1e2d3c4b5a6...",
      "ticketCount": 100,
      "createdAt": "2023-06-15T14:30:00.000Z",
      "revealedAt": "2023-06-15T15:00:00.000Z"
    },
    {
      "prizeDrawId": "123e4567-e89b-12d3-a456-426614174000",
      "prizeRank": 2,
      "localSeed": "3210abcdef9876...",
      "blockNumber": 12345678,
      "commitmentHash": "b2c3d4e5f6a7...",
      "blockHash": "f1e2d3c4b5a6...",
      "combinedSeed": "9876543210fedcba...",
      "ticketListHash": "e2d3c4b5a6f1...",
      "ticketCount": 100,
      "createdAt": "2023-06-15T14:30:00.000Z",
      "revealedAt": "2023-06-15T15:00:00.000Z"
    }
  ],
  "updatedAt": "2023-06-15T15:00:00.000Z"
}
```

Key fields for each reveal:
- `prizeRank`: The rank/number of the prize (1 for first prize, 2 for second prize, etc.)
- `blockHash`: Hash of the target Ethereum block
- `combinedSeed`: SHA-256 hash of localSeed + blockHash
- `revealedAt`: Timestamp when the reveal was created

## Verification Process

The commit-reveal protocol used by Sorteo ensures randomness cannot be manipulated:

1. **Commitment Phase**: 
   - A random local seed is generated
   - It's combined with a future Ethereum block number
   - The commitment hash is created and stored in this repository
   - The timestamp of this commit proves the commitment was made before the block was mined

2. **Ticket Collection Phase**:
   - Tickets are collected while waiting for the target block
   - When the draw ends, ticket list data is added to this repository
   - The ticket list hash ensures the ticket list cannot be changed

3. **Reveal Phase**:
   - After the target block is mined, its hash is retrieved
   - The hash is combined with the local seed to create a combined seed
   - The reveal data is uploaded to this repository
   - The timestamp of this commit proves when the reveal occurred

4. **Winner Selection**:
   - For each prize, the combined seed from its reveal is used to deterministically select a winning ticket
   - Each prize has its own independent selection process based on its unique combined seed
   - Since the combined seeds could not be predicted or manipulated, the selection is provably fair for all prizes

## Auditing Draws

We encourage third-party audits of our prize draws. To audit a draw:

1. Find the draw folder using the prize draw ID
2. Verify the GitHub commit timestamps match the expected timeline for all prizes
3. For each prize, verify all cryptographic hashes using the provided tools
4. For each prize, verify the winner selection using that prize's combined seed and the ticket list
5. Confirm that each prize had its own independent verification process

For detailed auditing instructions, see [our auditor's guide](https://sorteo.co.uk/help/auditors/).

## License

Creative Commons Attribution 4.0 International (CC BY 4.0)

This repository is licensed under the Creative Commons Attribution 4.0 International License.

You are free to:

- Share — copy and redistribute the material in any medium or format
- Adapt — remix, transform, and build upon the material for any purpose, even commercially

Under the following terms:

- Attribution — You must give appropriate credit, provide a link to the license, and indicate if changes were made.

Full legal code: https://creativecommons.org/licenses/by/4.0/legalcode  
Plain English summary: https://creativecommons.org/licenses/by/4.0/